#!/bin/bash
# This file is @generated by <https://github.com/liblaf/copier-python>.
# DO NOT EDIT!
set -o errexit
set -o nounset
set -o pipefail

function has() {
  type "$@" &> /dev/null
}

TEMPLATE="\
# >>> tangerine-start: lazy-loader.py >>>
import lazy_loader as lazy

__getattr__, __dir__, __all__ = lazy.attach_stub(__name__, __file__)
# <<< tangerine-end <<<
"

git_root=$(git rev-parse --show-toplevel)
src_dir="$git_root/src"
if [[ -d $src_dir ]]; then
  while IFS= read -d '' -r file; do
    file="${file/%'.pyi'/'.py'}"
    if has tangerine; then
      if [[ ! -f $file ]]; then
        tangerine <<< "$TEMPLATE" > "$file"
      else
        tangerine --in-place "$file"
      fi
    else
      if [[ ! -f $file ]]; then
        printf '%s' "$TEMPLATE" > "$file"
      else
        : # skip existing files
      fi
    fi
  done < <(find "$src_dir" -name '__init__.pyi' -type f -print0)
fi
